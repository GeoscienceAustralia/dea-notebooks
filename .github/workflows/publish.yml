name: Publish dea-tools to PyPI

on:
  push:
    branches:
      - develop
    paths:
      - 'Tools/**'
  release:
    types: [published]
  workflow_dispatch:

jobs:
  publish:
    runs-on: ubuntu-latest

    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2
      
      - name: Build dea-tools
        run: |
            cd Tools
            pip install --upgrade pip
            pip install . --use-feature=in-tree-build
            python -c "import dea_tools; print(dea_tools.__version__)"

#       - name: pypi-publish
#         # You may pin to the exact commit or the version.
#         # uses: pypa/gh-action-pypi-publish@27b31702a0e7fc50959f5ad993c78deac1bdfc29
#         uses: pypa/gh-action-pypi-publish@v1.4.2
#         with:
#           # PyPI user
#           user: ${{ secrets.PYPI_USER }}
#           # Password for your PyPI user or an access token
#           password: ${{ secrets.PYPI_PASS }}
#           # The repository URL to use
#           repository_url: https://github.com/GeoscienceAustralia/dea-notebooks#subdirectory=Tools
#           # The target directory for distribution
#           packages_dir: Tools/*
#           # Check metadata before uploading
#           verify_metadata: true
#           # Do not fail if a Python package distribution exists in the target package index
#           skip_existing: false
#           # Show verbose output.
#           verbose: true
